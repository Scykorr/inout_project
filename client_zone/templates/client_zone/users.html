<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Обзор Клиентской Зоны</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/users.css' %}">
</head>
<body>
    <div class="container">
        <!-- Sidebar (navigation bar) -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <img src="{% static 'img/half logo.svg' %}" alt="Логотип" class="logo-image">
                <span class="logo-text">Клиентская зона</span>
            </div>

            <ul class="menu">
                <li>
                    <img src="{% static 'img/overview.svg' %}" alt="Обзор" width="20" height="20">
                    <a href="{% url 'client_zone:overview' %}">Обзор</a>
                </li>
                <li>
                    <img src="{% static 'img/info.svg' %}" alt="Информация о Продукте" width="20" height="20">
                    <a href="{% url 'client_zone:product-details' %}">Информация о продукте</a>

                </li>
                <li>
                    <img src="{% static 'img/invoises.svg' %}" alt="Счета и КП" width="20" height="20">
                    <a href="{% url 'client_zone:invoices' %}">Счета и кп</a>

                </li>
                <li>
                    <img src="{% static 'img/details.svg' %}" alt="Детали выставления счета" width="20" height="20">
                    <a href="{% url 'client_zone:billing' %}">Детали выставления счёта</a>

                </li>
                <li>
                    <img src="{% static 'img/users.svg' %}" alt="Пользователи" width="20" height="20">
                    <a href="{% url 'client_zone:users' %}">Пользователи</a>

                </li>
                <li>
                    <img src="{% static 'img/help.svg' %}" alt="Центр поддержки" width="20" height="20">
                    <a href="{% url 'client_zone:help' %}">Центр поддержки</a>

                </li>
            </ul>
            <div class="sidebar-footer">
                <img src="{% static 'img/logo.svg' %}" alt="Логотип">
            </div>
        </div>
        <!-- Main Content -->
        <div class="main-content">
            <header>
                <div class="block-help">
                    <div class="menu-toggle" id="menuToggle">
                        <div class="hamburger">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>
                    <h2 class="logo-title">Пользователи</h2>
                </div>
                <div class="user-info">
                    <span class="user-name">Test User</span>
                    <img class="account-icon" src="{% static 'img/account.svg' %}" alt="Account Icon">
                    <button class="logout">
                        <img src="{% static 'img/leave.svg' %}" alt="Logout Icon">
                    </button>
                </div>
            </header>
            <section class="users-section">
                <div class="users-header">
                    <h2>Пользователи</h2>
                    <button id="add-user-btn" class="add-user-btn">Добавить пользователя</button>
                </div>
                <div class="users-table-container">
                    <div class="users-table-header">
                        <table>
                            <thead>
                                <tr>
                                    <th>Имя</th>
                                    <th>Уровень доступа</th>
                                    <th>Email</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="users-table-body">
                        <table>
                            <tbody>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <button id="edit-btn" class="edit-btn"> <img src="client zone/Edit.svg"/></button>
                                        <button id="delete-btn" class="delete-btn"><img src="client zone/Delete.svg"/></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </div>
<!-- Попап для добавления пользователя -->
<!-- Кнопка для открытия попапа добавления пользователя -->
<button id="add-user-btn">Добавить пользователя</button>

<!-- Попап для добавления пользователя -->
<!-- Попап для добавления пользователя -->
<div id="userPopup" class="user-popup-overlay">
  <div class="user-popup-content">
    <span class="user-popup-close-button">&times;</span>
    <h2>Добавить нового пользователя</h2>
    <form id="userForm"> <!-- Добавлено id для формы -->
      <div class="user-form-group">
        <label for="userFullName">Полное имя</label>
        <input type="text" id="userFullName" name="fullName" required>
      </div>

      <div class="user-form-group">
        <label for="userEmail">Почта</label>
        <input type="email" id="userEmail" name="email" required>
      </div>

      <div class="user-form-group">
        <label for="userPassword">Пароль</label>
        <input type="password" id="userPassword" name="password" required>
      </div>

      <div class="user-switch-container">
        <div class="user-access-level">
          <h3>Уровень доступа</h3>
          <div class="user-switch-item">
            <label for="adminAccess" class="user-switch">
              <input type="checkbox" id="adminAccess">
              <span class="user-slider"></span>
            </label>
            <label for="adminAccess">Администратор</label>
          </div>
          <div class="user-switch-item">
            <label for="scanAccess" class="user-switch">
              <input type="checkbox" id="scanAccess">
              <span class="user-slider"></span>
            </label>
            <label for="scanAccess">Сканирование</label>
          </div>
          <div class="user-switch-item">
            <label for="purchaseAccess" class="user-switch">
              <input type="checkbox" id="purchaseAccess">
              <span class="user-slider"></span>
            </label>
            <label for="purchaseAccess">Заказ на покупку</label>
          </div>
          <div class="user-switch-item">
            <label for="invoiceAccess" class="user-switch">
              <input type="checkbox" id="invoiceAccess">
              <span class="user-slider"></span>
            </label>
            <label for="invoiceAccess">Выставление счета</label>
          </div>
          <div class="user-switch-item">
            <label for="supportAccess" class="user-switch">
              <input type="checkbox" id="supportAccess">
              <span class="user-slider"></span>
            </label>
            <label for="supportAccess">Поддержка</label>
          </div>
        </div>
      </div>
      <button type="submit">Отправить</button>
    </form>
  </div>
</div>

<div id="editPopup" class="user-popup-overlay">
  <div class="user-popup-content">
    <span class="user-popup-close-button">&times;</span>
    <h2>Редактировать пользователя</h2>
    <form>
        <h3>Персональная информация</h3>
      <div class="user-form-group">
        <label for="userFullName">Полное имя</label>
        <input type="text" id="userFullName" name="fullName" value="quantumteam">
      </div>

      <div class="user-form-group">
        <label for="userEmail">Почта</label>
        <input type="email" id="userEmail" name="email" value="quantumteam">
      </div>

      <div class="user-form-group">
        <label for="userPassword">Пароль</label>
        <input type="password" id="userPassword" name="password" value="quantumteam">
      </div>

      <div class="user-switch-container">
        <div class="user-access-level">
          <h4>Уровень доступа</h4>
          <div class="user-switch-item">
            <label for="adminAccess" class="user-switch">
              <input type="checkbox" id="adminAccess" checked>
              <span class="user-slider"></span>
            </label>
            <label for="adminAccess">Администратор</label>
          </div>
          <div class="user-switch-item">
            <label for="scanAccess" class="user-switch">
              <input type="checkbox" id="scanAccess">
              <span class="user-slider"></span>
            </label>
            <label for="scanAccess">Сканирование</label>
          </div>
          <div class="user-switch-item">
            <label for="purchaseAccess" class="user-switch">
              <input type="checkbox" id="purchaseAccess">
              <span class="user-slider"></span>
            </label>
            <label for="purchaseAccess">Заказ на покупку</label>
          </div>
          <div class="user-switch-item">
            <label for="invoiceAccess" class="user-switch">
              <input type="checkbox" id="invoiceAccess">
              <span class="user-slider"></span>
            </label>
            <label for="invoiceAccess">Выставление счета</label>
          </div>
          <div class="user-switch-item">
            <label for="supportAccess" class="user-switch">
              <input type="checkbox" id="supportAccess">
              <span class="user-slider"></span>
            </label>
            <label for="supportAccess">Поддержка</label>
          </div>
        </div>

        <div class="user-email-notifications">
          <h4>Уведомления на почту</h4>
          <div class="user-switch-item">
            <label for="allNotifications" class="user-switch">
              <input type="checkbox" id="allNotifications" checked>
              <span class="user-slider"></span>
            </label>
            <label for="allNotifications">Все</label>
          </div>
          <div class="user-switch-item">
            <label for="productNews" class="user-switch">
              <input type="checkbox" id="productNews">
              <span class="user-slider"></span>
            </label>
            <label for="productNews">Новости о продукте</label>
          </div>
        </div>
      </div>
      <button type="submit">Отправить</button>
    </form>
  </div>
</div>
<div id="profile-popup" class="profile-popup">
            <div class="profile-popup-content">
                <span class="close-btn" id="closeProfilePopup">&times;</span>
                <h2>Редактировать профиль</h2>
                <form>
                    <div class="form-container"> 
                        <div class="form-left">
                            <label for="full-name">Полное имя</label>
                            <input type="text" id="full-name" required>

                            <label for="email">Почта</label>
                            <input type="email" id="email" required>

                            <label for="password">Пароль</label>
                            <input type="password" id="password" required>

                            <label for="confirm-password">Подтверждение пароля</label>
                            <input type="password" id="confirm-password" required">
                        </div>

                        <div class="form-right">
                            <h3>Уведомления на почту</h3>
                            <div class="toggle-group">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <label>Все пункты</label>
                            </div>
                            <div class="toggle-group">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <label>Новости о продукте</label>
                            </div>
                            <div class="toggle-group">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <label>Обновления ПО</label>
                            </div>
                            <div class="toggle-group">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <label>Срок действия контракта</label>
                            </div>
                            <div class="toggle-group">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                                <label>Счета и коммерческие предложения</label>
                            </div>
                        </div>
                    </div>

                    <button type="submit">Сохранить</button> 
                </form>
            </div>
        </div>
<script>
    // Toggle Sidebar и смещение контента
    document.getElementById("menuToggle").addEventListener("click", function() {
        const sidebar = document.getElementById("sidebar");
        const mainContent = document.querySelector(".main-content");
        
        // Переключаем класс hidden у sidebar
        sidebar.classList.toggle("hidden");
        
        // Если sidebar скрыт, смещаем основной контент
        if (sidebar.classList.contains("hidden")) {
            mainContent.classList.add("shifted");
        } else {
            mainContent.classList.remove("shifted");
        }
    })

function openPopup(triggerSelector, popupId) {
    const trigger = document.querySelector(triggerSelector);
    const popup = document.getElementById(popupId);

    if (trigger && popup) {
        // Открытие попапа при клике на элемент
        trigger.addEventListener('click', () => {
            popup.style.display = 'flex'; // flex для центрирования
        });

        // Закрытие попапа при нажатии на крестик
        const closeBtn = popup.querySelector('.close-btn') || popup.querySelector('.user-popup-close-button');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                popup.style.display = 'none';
            });
        }

        // Закрытие попапа при клике вне его контента
        window.addEventListener('click', (event) => {
            if (event.target === popup) {
                popup.style.display = 'none';
            }
        });
    }
}

// Открытие попапов
openPopup('.account-icon', 'profile-popup'); // Попап для профиля
openPopup('#add-user-btn', 'userPopup'); 
openPopup('#edit-btn', 'editPopup');     // Попап для добавления пользователя

document.querySelectorAll('.user-switch input').forEach(switchElement => {
    switchElement.addEventListener('change', function() {
        const slider = this.nextElementSibling;
        if (this.checked) {
            slider.classList.add('active');
        } else {
            slider.classList.remove('active');
        }
    });
});
    document.getElementById('userForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission

    // Collect roles based on checked checkboxes
    const roles = [];
    if (document.getElementById('adminAccess').checked) roles.push('admin');
    if (document.getElementById('scanAccess').checked) roles.push('scanning');
    if (document.getElementById('purchaseAccess').checked) roles.push('ordering');
    if (document.getElementById('invoiceAccess').checked) roles.push('billing');
    if (document.getElementById('supportAccess').checked) roles.push('help');

    // Convert roles array to a string (or use another format as needed)
    const rolesString = roles.join(',');

    // Prepare data for submission (you can use fetch or XMLHttpRequest)
    const formData = {
      fullName: document.getElementById('userFullName').value,
      email: document.getElementById('userEmail').value,
      password: document.getElementById('userPassword').value,
      roles: rolesString,
    };

    console.log(formData); // For testing: log the data to be submitted

    // Implement your data submission logic here
  });

    document.addEventListener('DOMContentLoaded', function () {
    let userCount = 0;
    const maxUsers = 10;

    const userForm = document.getElementById('userForm');
    const usersTableBody = document.querySelector('.users-table-body tbody');
    const userPopup = document.getElementById('userPopup');
    const closePopupButton = document.querySelector('.user-popup-close-button');

    // Обработчик формы добавления пользователя
    userForm.addEventListener('submit', function (event) {
        event.preventDefault();

        if (userCount >= maxUsers) {
            alert('Вы не можете добавить более 10 пользователей.');
            return;
        }

        const fullName = document.getElementById('userFullName').value;
        const email = document.getElementById('userEmail').value;

        // Сбор ролей
        const roles = [];
        if (document.getElementById('adminAccess').checked) roles.push('Администратор');
        if (document.getElementById('scanAccess').checked) roles.push('Сканирование');
        if (document.getElementById('purchaseAccess').checked) roles.push('Заказ на покупку ');
        if (document.getElementById('invoiceAccess').checked) roles.push('Выставление счета');
        if (document.getElementById('supportAccess').checked) roles.push('Поддержка');

        // Создание новой строки пользователя
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td>${fullName}</td>
          <td>${roles.join(', ') || 'Нет роли'}</td>
          <td>${email}</td>
          <td>
            <button class="edit-btn"><img src="{% static 'img/edit.svg' %}" alt="Редактировать" /></button>
            <button class="delete-btn"><img src="{% static 'img/delete.svg' %}" alt="Удалить" /></button>
          </td>
        `;

        usersTableBody.appendChild(newRow);
        userCount++;

        // Закрыть попап после добавления пользователя
        userPopup.style.display = 'none';

        // Очистить форму после отправки
        userForm.reset();
    });

    // Закрыть попап по кнопке
    closePopupButton.addEventListener('click', function () {
        userPopup.style.display = 'none';
    });
});

    document.addEventListener('DOMContentLoaded', function () {
  const usersTableBody = document.querySelector('.users-table-body tbody');

  // Удаление пользователя
  usersTableBody.addEventListener('click', function (event) {
    if (event.target.classList.contains('delete-btn') || event.target.closest('.delete-btn')) {
      const row = event.target.closest('tr');
      row.remove();
    }
  });
});


    document.addEventListener('DOMContentLoaded', function () {
  const usersTableBody = document.querySelector('.users-table-body tbody');

  // Редактирование пользователя
  usersTableBody.addEventListener('click', function (event) {
    if (event.target.classList.contains('edit-btn') || event.target.closest('.edit-btn')) {
      const row = event.target.closest('tr');
      const fullName = row.children[0].textContent;
      const roles = row.children[1].textContent;
      const email = row.children[2].textContent;

      // Открываем попап с заполненными полями
      document.getElementById('userFullName').value = fullName;
      document.getElementById('userEmail').value = email;

      // Нужно обновить информацию о ролях (псевдокод)
      updateRolesInForm(roles);

      // Показываем попап
      userPopup.style.display = 'block';

      // В этом месте добавляем логику для обновления пользователя после сохранения
    }
  });

  function updateRolesInForm(roles) {
    // Логика для обновления чекбоксов на основе ролей
    document.getElementById('adminAccess').checked = roles.includes('Администратор');
    document.getElementById('scanAccess').checked = roles.includes('Сканирование');
    document.getElementById('purchaseAccess').checked = roles.includes('Заказ на покупку');
    document.getElementById('invoiceAccess').checked = roles.includes('Выставление счета');
    document.getElementById('supportAccess').checked = roles.includes('Поддержка');
  }
});

</script>
</body>
</html>
