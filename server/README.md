# Инструкция по установке проекта

---
## Важно

Если в ходе проверок статусов и подключении настроек возникают проблемы и ошибки, то нужно скопировать то, что вывелось в консоль после команды и отправить мне в чат, я смогу на основе вывода подсказать что пошло не так и что нужно исправить.

---

## Процесс настройки

1. Установка пакетов:
- git
- nginx
- python3-venv
- python-dev
- python3-dev
- postgresql postgresql-contrib

Для этого необходимо выполнить команды:

```shell
sudo apt install git nginx python3-dev python3-venv postgresql postgresql-contrib
```

2. Перенес исходников на сервер и настройка окружения:

```shell
cd /opt
git  clone <repo_url>
```

- После того, как исходники будут скачаны, необходимо настроить окружение:

```shell
cd /opt/site
python3 -m venv env
source env/bin/activate
pip3 install -r requirements 
```

3. Миграции, статика и проверка работоспособности

- Нужно создать переменные окружения из шаблона:
```shell
cp .env.sample .env
```

Далее, вручную записать секретные ключи и адреса(доступы к базе данных)

Нужно заполнить `DATABASE_USER`, `DATABASE_HOST`, `DATABASE_NAME`, `DATABASE_PASSWORD`

Нужно импортировать дамп базы данных, он лежит в корне проекта, файл называется in.sql

Также распаковать media.zip в папку media в корне проекта

Далее собрать всю статику воедино:
```shell
python3 manage.py collectstatic
```

Нужно будет согласиться с командой и подтвердить свое действие.

После этого можно тестово запустить проект и проверить, что он работает:
```shell
python3 manage.py runserver 0.0.0.0:8000
```

Как только проект запустится, можно в браузер ввести ip адрес вашего сервера и порт 8000, то есть в браузере должно получиться что-то на подобии такого: http://192.168.0.100:8000

**Если откроется сайт, значит, все хорошо и можно переходить к демонизации процецесса и настройке веб-сервера**

Можно деактивировать виртуальное окружение, чтобы оно не мешало в работе, для остановики сайта использовать ctrl+c, а для даективации:
```shell
deactivate
```

4. Настройка и активация демона

Настройки демона лежат в папке `server` в проекте, поэтому, для активации демона нужно выполнить следующие команды:

```shell
cp /opt/booker/server/site.service /etc/systemd/system/
systemctl start site
systemctl status site
```

Если статус показывает, что все хорошо и нет никаких проблем, нужно активировать демона, чтобы он запускался при перезагрузке сервера или при возникновении ошибок:
```shell
systemctl enable site
```

5. Настройка веб-сервера

В самом начале мы установили nginx и теперь будем настраивать его для работы с нашим проектом.

Все настройки для вас я подготовил, нужно будет только внести корректный адрес, если у вас нет домена, то это может быть просто ip адрес вашего сервера.

После того, как внесли настройку, можно скопировать ее и активировать:
```shell
cp /opt/booker/server/nginx.conf /etc/nginx/sites-available/site
ln -s /etc/nginx/sites-available/booker /etc/nginx/sites-enabled/ 
```
Теперь нужно проверить, что все хорошо:
```shell
nginx -t
```

Если команда выдала сообщение, что все ок, то нужно перезапустить сервис и начать пользоваться системой:
```shell
systemctl restart nginx
```
