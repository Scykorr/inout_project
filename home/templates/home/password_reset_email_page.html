{% extends "base/base.html" %}
{% load static wagtailcore_tags %}


{% block content %}
    <!-- Основной контент -->
    <main class="main">
        <div class="container">
            <div class="border"></div>
            <div class="content-left">
                <img src="{% static 'images/tag.svg' %}" class="svg-image">
                <button type="button" class="about-btn">Подробнее</button>
            </div>

            <div class="content-right">
                <img src="{% static 'images/big-logo.svg' %}" width="324" height="53" alt="INOUT Проект" class="logo-image">
                <form id="reset-password-form" method="post">
                    {% csrf_token %}
                    <h2>Восстановление пароля</h2>
                    <div class="input-group">
                        <label for="email" class="email_t">Почта</label>
                        {{ form.email }}
                    </div>
                    <button type="submit" id="submit-btn" class="btn">Продолжить</button>
                </form>
                <div id="message-container" class="message-container" style="display: none;">
                    <p><strong>На вашу почту отправлен новый пароль</strong></p>
                    <p>В скором времени на указанную почту придет письмо с ссылкой для восстановления пароля.</p>
                </div>
                <button type="button" id="login-btn" class="btn" style="display: none;">Вход</button>
                </div>
            </div>
        </div>
    </main>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    var form = document.getElementById('reset-password-form');
    var messageContainer = document.getElementById('message-container');
    var loginBtn = document.getElementById('login-btn');

    // Получение CSRF-токена из cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            let cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var csrfToken = getCookie('csrftoken');

    form.addEventListener('submit', function(event) {
        event.preventDefault(); // Предотвращаем стандартное поведение формы
        var formData = new FormData(form);

        fetch('/accounts/reset_password/', { // Убедитесь, что URL правильный
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken // Добавляем CSRF-токен в заголовки
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                form.style.display = 'none'; // Скрываем форму
                messageContainer.style.display = 'block'; // Показываем контейнер сообщения
                loginBtn.style.display = 'block'; // Показываем кнопку входа
            } else {
                alert(data.error || 'Ошибка при отправке формы'); // Показать ошибку
            }
        })
        .catch(error => {
            console.error('Error:', error); // Логируем ошибку в консоль
        });
    });

    loginBtn.addEventListener('click', function() {
        window.location.href = '/accounts/login/'; // Перенаправление на страницу входа
    });
});

    </script>
{% endblock content %}